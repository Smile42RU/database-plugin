DROP TABLEarchi_plugin;
DROP TABLE bendpoints;
DROP TABLE database_version;
DROP TABLE elements;
DROP TABLE elements_in_model;
DROP TABLE folders;
DROP TABLE folders_in_model;
DROP TABLE images;
DROP TABLE models;
DROP TABLE properties;
DROP TABLE relationships;
DROP TABLE relationships_in_model;
DROP TABLE views;
DROP TABLE views_connections;
DROP TABLE views_in_model;
DROP TABLE views_objects;

CREATE TABLE bendpoints (
  parent_id      varchar(50) NOT NULL, 
  parent_version int NOT NULL, 
  rank           int NOT NULL, 
  start_x        int NOT NULL, 
  start_y        int NOT NULL, 
  end_x          int NOT NULL, 
  end_y          int NOT NULL, 
  PRIMARY KEY (parent_id, 
  parent_version, 
  rank));
CREATE TABLE database_version (
  archi_plugin varchar(50) NOT NULL, 
  version      int NOT NULL);
CREATE TABLE elements (
  id            varchar(50) NOT NULL, 
  version       int NOT NULL, 
  class         varchar(50) NOT NULL, 
  name          varchar(1024) NOT NULL, 
  documentation text NOT NULL, 
  type          varchar(3) NULL, 
  created_by    varchar(30) NOT NULL, 
  created_on    datetime NOT NULL, 
  checkedin_by  varchar(30) NULL, 
  checkedin_on  datetime NULL, 
  deleted_by    varchar(30) NULL, 
  deleted_on    datetime NULL, 
  checksum      varchar(50) NOT NULL, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE elements_in_model (
  cin_id           int IDENTITY NOT NULL, 
  element_id       varchar(50) NOT NULL, 
  element_version  int NOT NULL, 
  parent_folder_id varchar(50) NOT NULL, 
  model_id         varchar(50) NOT NULL, 
  model_version    int NOT NULL, 
  rank             int NOT NULL, 
  PRIMARY KEY (cin_id));
CREATE TABLE folders (
  id            varchar(50) NOT NULL, 
  version       int NOT NULL, 
  type          int NOT NULL, 
  root_type     int NOT NULL, 
  name          varchar(1024) NOT NULL, 
  documentation text NOT NULL, 
  created_by    varchar(30) NULL, 
  created_on    datetime NULL, 
  checksum      varchar(50) NOT NULL, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE folders_in_model (
  fin_id           int IDENTITY NOT NULL, 
  folder_id        varchar(50) NOT NULL, 
  folder_version   int NOT NULL, 
  parent_folder_id varchar(50) NULL, 
  model_id         varchar(50) NOT NULL, 
  model_version    int NOT NULL, 
  rank             int NOT NULL, 
  PRIMARY KEY (fin_id));
CREATE TABLE images (
  path     varchar(50) NOT NULL, 
  image    image NOT NULL, 
  checksum varchar(50) NOT NULL, 
  PRIMARY KEY (path));
CREATE TABLE models (
  id           varchar(50) NOT NULL, 
  version      int NOT NULL, 
  name         varchar(1024) NOT NULL, 
  note         text NULL, 
  purpose      text NULL, 
  created_by   varchar(30) NOT NULL, 
  created_on   datetime NOT NULL, 
  checkedin_by varchar(30) NULL, 
  checkedin_on datetime NULL, 
  deleted_by   varchar(30) NULL, 
  deleted_on   datetime NULL, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE properties (
  parent_id      varchar(50) NOT NULL, 
  parent_version int NOT NULL, 
  rank           int NOT NULL, 
  name           varchar(1024) NOT NULL, 
  value          text NOT NULL, 
  PRIMARY KEY (parent_id, 
  parent_version, 
  rank));
CREATE TABLE relationships (
  id            varchar(50) NOT NULL, 
  version       int NOT NULL, 
  class         varchar(50) NOT NULL, 
  name          varchar(1024) NOT NULL, 
  documentation text NOT NULL, 
  source_id     varchar(50) NULL, 
  target_id     varchar(50) NULL, 
  strength      varchar(20) NULL, 
  access_type   int NULL, 
  created_by    varchar(30) NOT NULL, 
  created_on    datetime NOT NULL, 
  checkedin_by  varchar(30) NULL, 
  checkedin_on  datetime NULL, 
  deleted_by    varchar(30) NULL, 
  deleted_on    datetime NULL, 
  checksum      varchar(50) NOT NULL, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE relationships_in_model (
  cin_id               int IDENTITY NOT NULL, 
  relationship_id      varchar(50) NOT NULL, 
  relationship_version int NOT NULL, 
  parent_folder_id     varchar(50) NOT NULL, 
  model_id             varchar(50) NOT NULL, 
  model_version        int NOT NULL, 
  rank                 int NOT NULL, 
  PRIMARY KEY (cin_id));
CREATE TABLE views (
  id                     varchar(50) NOT NULL, 
  version                int NOT NULL, 
  class                  varchar(50) NOT NULL, 
  name                   varchar(1024) NOT NULL, 
  documentation          text NOT NULL, 
  hint_content           text NULL, 
  hint_title             varchar(1024) NULL, 
  created_by             varchar(30) NOT NULL, 
  created_on             datetime NOT NULL, 
  background             int NULL, 
  connection_router_type int NOT NULL, 
  viewpoint              varchar(30) NULL, 
  checksum               varchar(50) NOT NULL, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE views_connections (
  id               varchar(50) NOT NULL, 
  version          int NOT NULL, 
  container_id     varchar(50) NOT NULL, 
  view_id          varchar(50) NOT NULL, 
  view_version     int NOT NULL, 
  class            varchar(50) NOT NULL, 
  name             varchar(1024) NULL, 
  documentation    text NULL, 
  is_locked        tinyint NULL, 
  line_color       varchar(7) NULL, 
  line_width       int NULL, 
  font             varchar(150) NULL, 
  font_color       varchar(7) NULL, 
  relationship_id  varchar(50) NULL, 
  source_object_id varchar(50) NULL, 
  target_object_id varchar(50) NULL, 
  type             int NULL, 
  rank             int NOT NULL, 
  checksum         varchar(50) NOT NULL, 
  PRIMARY KEY (id, 
  version, 
  container_id));
EXEC sp_addextendedproperty 
  @NAME = N'MS_Description', @VALUE = N'views_connections parents can be either a view, a canvas or a sketch but any container as well.', 
  @LEVEL0TYPE = N'Schema', @LEVEL0NAME = N'dbo', 
  @LEVEL1TYPE = N'Table', @LEVEL1NAME = N'views_connections';
CREATE TABLE views_in_model (
  vin_id           int IDENTITY NOT NULL, 
  view_id          varchar(50) NOT NULL, 
  view_version     int NOT NULL, 
  parent_folder_id varchar(50) NOT NULL, 
  model_id         varchar(50) NOT NULL, 
  model_version    int NOT NULL, 
  rank             int NULL, 
  PRIMARY KEY (vin_id));
CREATE TABLE views_objects (
  id             varchar(50) NOT NULL, 
  version        int NOT NULL, 
  container_id   varchar(50) NOT NULL, 
  view_id        varchar(50) NOT NULL, 
  view_version   int NOT NULL, 
  class          varchar(50) NOT NULL, 
  element_id     varchar(50) NULL, 
  diagram_ref_id varchar(50) NULL, 
  border_color   varchar(7) NULL, 
  border_type    int NULL, 
  content        text NULL, 
  documentation  text NULL, 
  hint_content   text NULL, 
  hint_title     varchar(1024) NULL, 
  is_locked      tinyint NULL, 
  image_path     varchar(50) NULL, 
  image_position int NULL, 
  line_color     varchar(7) NULL, 
  line_width     int NULL, 
  fill_color     varchar(7) NULL, 
  font           varchar(150) NULL, 
  font_color     varchar(7) NULL, 
  name           varchar(1024) NULL, 
  notes          text NULL, 
  text_alignment int NULL, 
  text_position  int NULL, 
  type           int NULL, 
  x              int NULL, 
  y              int NULL, 
  width          int NULL, 
  height         int NULL, 
  rank           int NOT NULL, 
  checksum       varchar(50) NOT NULL, 
  PRIMARY KEY (id, 
  version, 
  container_id));
EXEC sp_addextendedproperty 
  @NAME = N'MS_Description', @VALUE = N'views_objects parents can be either a view, a canvas or a sketch but any container as well.', 
  @LEVEL0TYPE = N'Schema', @LEVEL0NAME = N'dbo', 
  @LEVEL1TYPE = N'Table', @LEVEL1NAME = N'views_objects';
EXEC sp_addextendedproperty 
  @NAME = N'MS_Description', @VALUE = N'the import order is important to respect the superposition', 
  @LEVEL0TYPE = N'Schema', @LEVEL0NAME = N'dbo', 
  @LEVEL1TYPE = N'Table', @LEVEL1NAME = N'views_objects', 
  @LEVEL2TYPE = N'Column', @LEVEL2NAME = N'rank';

INSERT INTO database_version (archi_plugin, version) VALUES('DatabasePlugin', 200);