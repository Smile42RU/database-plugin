<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<title>Model export</title>
	<style>
		.image {
			border: 1px solid #0;
			display: block;
			margin-left: auto;
			margin-right: auto;
			box-shadow: 10px 10px 5px #ccc;
			-moz-box-shadow: 10px 10px 5px #ccc;
			-webkit-box-shadow: 10px 10px 5px #ccc;
			-khtml-box-shadow: 10px 10px 5px #ccc;
		}
		li.selected {
			background: url('../img/selected.png') no-repeat left top;
			padding-left: 20px;
			display: block;
		}
		li.not_selected {
			background: url('../img/not_selected.png') no-repeat left top;
			padding-left: 20px;
			display: block;
		}
		#toc {
		    background: #f9f9f9 none repeat scroll 0 0;
		    border: 1px solid #aaa;
		    display: table;
		    font-size: 95%;
		    margin-bottom: 1em;
		    padding: 20px;
		    width: auto;
		    margin-left: 10%;
		}
		.toc_title {
		    font-weight: 700;
		    text-align: center;
		    color: blue;
		    text-decoration: underline;
		}
		#toc li, #toc ul, #toc ul li {
		    list-style: outside none none !important;
		}
	</style>
</head>

<body>
<h1 style="color: blue; text-decoration: underline;">Database structure</h1>
<br>
<div id="toc">
<p class="toc_title">Table of contents</p>
<ul class="toc_list">
   <li><a href="#1">1. Tables</a><ul>
      <li><a href="#1.1">1.1. database_version</a></li>
      <li><a href="#1.2">1.2. models</a><li>
      <li><a href="#1.3">1.3. folders</a></li>
      <li><a href="#1.4">1.4. elements</a></li>
      <li><a href="#2.1">1.5. relationships</a></li>
      <li><a href="#2.1">1.6. views</a></li>
      <li><a href="#2.1">1.7. views_objects</a></li>
      <li><a href="#2.1">1.8. views_connections</a></li>
      <li><a href="#2.1">1.9. folders_in_model</a></li>
      <li><a href="#2.1">1.10. elements_in_model</a></li>
      <li><a href="#2.1">1.11. relationships_in_model</a></li>
      <li><a href="#2.1">1.12. views_in_model</a></li>
      <li><a href="#2.1">1.13. images</a></li>
      <li><a href="#2.1">1.14. bendpoints</a></li>
      <li><a href="#2.1">1.15. properties</a></li>
   </ul></li>
</ul>
</div>
<br>
This document describes the structure of the tables needed by the database plugin in relational databases.<br>
<img class="image" src="../img/databaseStructure.jpg"><br>
<br>
<h3 id="1" style="color: blue; text-decoration: underline;">1. Tables</h3>
<h4 id="1.1" style="color: blue; text-decoration: underline;">1.1 database_version</h4>
This table allows the plugin to quickly check that the database has got the requested tables without checking all of them one by one.
It contains one line per plugin that has got tables in this database (this will allow several plugins to share the same database in the future):
<ul>
   <li>archi_plugin : the name of the database plugin
   <li>version : the version of the database model
</ul>
Each time the plugin connects to a database, it checks the existence and the content of this table.
<ul>
   <li>if the table does not exist, then it considers that all the other tables are missing and propose to create them,
   <li>if the table does exist but the plugin name is not listed, then the plugin refuses to work with the database,
   <li>if the plugin name is listed but the version is an old version, then the plugin updates the database to the newer version,
   <li>if the version is unknown, then the plugin refuses to work with the database.
</ul>

<h4 id="1.2" style="color: blue; text-decoration: underline;">1.1. models</h4>
This table contains the models metadata that are stored in the database. There is one line per model and per version.

<h4 id="1.3" style="color: blue; text-decoration: underline;">1.3. folders</h4>
This table contains the folders that are stored in the database. There is one line per folder and per version.

<h4 id="1.4" style="color: blue; text-decoration: underline;">1.4. elements</h4>
This table contains the elements that are stored in the database. There is one line per element and per version.

<h4 id="1.5" style="color: blue; text-decoration: underline;">1.5. relationships</h4>
This table contains the relationships that are stored in the database. There is one line per relationship and per version.

<h4 id="1.6" style="color: blue; text-decoration: underline;">1.6. views</h4>
This table contains the views (diagrams, canvas and sketchs) that are stored in the database. There is one line per view and per version.

<h4 id="1.7" style="color: blue; text-decoration: underline;">1.7. views_objects</h4>
This table contains the graphical objects (representation of elements, notes, ...) that are stored in the database. There is one line per graphical object and per version.<br>
View objects can therefore be linked to their corresponding elements (column element_id) or to an image (column image_path).<br>
A view object cannot exist outside a container which can be a view or another view object (column container_id).<br>
They are sorted (column rank) to guarantee they are imported in the same order as they are exported (to maintain which one is above which one).

<h4 id="1.8" style="color: blue; text-decoration: underline;">1.8. views_connections</h4>
This table contains the graphical connections (representation of relationships) that are stored in the database. There is one line per graphical connection and per version.<br>
View connections can therefore be linked to their corresponding relationship (column relationship_id), to their source and target that can be either elements or relationships (columns source_object_id and target_object_id) and of course to bendpoints.<br>
A view connections cannot exist outside a container which can be a view or a view object (column container_id).<br>
They are sorted (column rank) to guarantee they are imported in the same order as they are exported (to maintain which one is above which one).  

<h4 id="1.9" style="color: blue; text-decoration: underline;">1.9. folders_in_model</h4>
This is a relation table that permits to know which folders is included in which model. At this stage, a folder can be included in a unique model.

<h4 id="1.10" style="color: blue; text-decoration: underline;">1.10. elements_in_model</h4>
This is a relation table that permits to know which elements is included in which model. An element can be included in several models.

<h4 id="1.11" style="color: blue; text-decoration: underline;">1.11. relationships_in_model</h4>
This is a relation table that permits to know which relationships is included in which model. A relationship can be included in several models.

<h4 id="1.12" style="color: blue; text-decoration: underline;">1.12. views_in_model</h4>
This is a relation table that permits to know which views is included in which model. A view can be included in several models.

<h4 id="1.13" style="color: blue; text-decoration: underline;">1.13. images</h4>
This table contains the images stored in the database. There is one line per image. 

<h4 id="1.14" style="color: blue; text-decoration: underline;">1.14. bendpoints</h4>
This table contains the bendpoints stored in the database. 

<h4 id="1.15" style="color: blue; text-decoration: underline;">1.15. properties</h4>
This table maintains the properties of the models and their components. 

</body>
</html>