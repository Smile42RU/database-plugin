DROP SEQUENCE seq_elements_in_model;
DROP SEQUENCE seq_folders_in_model;
DROP SEQUENCE seq_relationships_in_model;
DROP SEQUENCE seq_views_in_model;

DROP TABLE archi_plugin CASCADE CONSTRAINTS;
DROP TABLE bendpoints CASCADE CONSTRAINTS;
DROP TABLE database_version CASCADE CONSTRAINTS;
DROP TABLE elements CASCADE CONSTRAINTS;
DROP TABLE elements_in_model CASCADE CONSTRAINTS;
DROP TABLE folders CASCADE CONSTRAINTS;
DROP TABLE folders_in_model CASCADE CONSTRAINTS;
DROP TABLE images CASCADE CONSTRAINTS;
DROP TABLE models CASCADE CONSTRAINTS;
DROP TABLE properties CASCADE CONSTRAINTS;
DROP TABLE relationships CASCADE CONSTRAINTS;
DROP TABLE relationships_in_model CASCADE CONSTRAINTS;
DROP TABLE views CASCADE CONSTRAINTS;
DROP TABLE views_connections CASCADE CONSTRAINTS;
DROP TABLE views_in_model CASCADE CONSTRAINTS;
DROP TABLE views_objects CASCADE CONSTRAINTS;


CREATE SEQUENCE seq_elements_in_model;
CREATE SEQUENCE seq_folders_in_model;
CREATE SEQUENCE seq_relationships_in_model;
CREATE SEQUENCE seq_views_in_model;

CREATE OR REPLACE TRIGGER trigger_elements_in_model
  BEFORE INSERT ON elements_in_model
  FOR EACH ROW
  BEGIN
    SELECT seq_elements_in_model.NEXTVAL INTO :NEW.eim_id FROM DUAL;
  END;
  
CREATE OR REPLACE TRIGGER trigger_folders_in_model
  BEFORE INSERT ON folders_in_model
  FOR EACH ROW
  BEGIN
    SELECT seq_folders_in_model.NEXTVAL INTO :NEW.fim_id FROM DUAL;
  END;

CREATE OR REPLACE TRIGGER trigger_relationships_in_model
  BEFORE INSERT ON relationships_in_model
  FOR EACH ROW
  BEGIN
    SELECT seq_relationships_in_model.NEXTVAL INTO :NEW.rim_id FROM DUAL;
  END;

CREATE OR REPLACE TRIGGER trigger_views_in_model
  BEFORE INSERT ON views_in_model
  FOR EACH ROW
  BEGIN
    SELECT seq_views_in_model.NEXTVAL INTO :NEW.vim_id FROM DUAL;
  END;

  
CREATE TABLE bendpoints (
  parent_id      varchar2(50) NOT NULL, 
  parent_version number(10) NOT NULL, 
  rank           number(10) NOT NULL, 
  start_x        number(10) NOT NULL, 
  start_y        number(10) NOT NULL, 
  end_x          number(10) NOT NULL, 
  end_y          number(10) NOT NULL, 
  PRIMARY KEY (parent_id, 
  parent_version, 
  rank));
CREATE TABLE database_version (
  archi_plugin varchar2(50) NOT NULL, 
  version      number(10) NOT NULL);
CREATE TABLE elements (
  id            varchar2(50) NOT NULL, 
  version       number(10) NOT NULL, 
  class         varchar2(50) NOT NULL, 
  name          varchar2(1024) NOT NULL, 
  documentation clob NOT NULL, 
  type          varchar2(3), 
  created_by    varchar2(30) NOT NULL, 
  created_on    timestamp NOT NULL, 
  checkedin_by  varchar2(30), 
  checkedin_on  timestamp, 
  deleted_by    varchar2(30), 
  deleted_on    timestamp, 
  checksum      varchar2(50) NOT NULL, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE elements_in_model (
  cin_id           number(10) NOT NULL, 
  element_id       varchar2(50) NOT NULL, 
  element_version  number(10) NOT NULL, 
  parent_folder_id varchar2(50) NOT NULL, 
  model_id         varchar2(50) NOT NULL, 
  model_version    number(10) NOT NULL, 
  rank             number(10) NOT NULL, 
  PRIMARY KEY (cin_id));
CREATE TABLE folders (
  id            varchar2(50) NOT NULL, 
  version       number(10) NOT NULL, 
  type          number(10) NOT NULL, 
  root_type     number(10) NOT NULL, 
  name          varchar2(1024) NOT NULL, 
  documentation clob NOT NULL, 
  created_by    varchar2(30), 
  created_on    timestamp, 
  checksum      varchar2(50) NOT NULL, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE folders_in_model (
  fin_id           number(10) NOT NULL, 
  folder_id        varchar2(50) NOT NULL, 
  folder_version   number(10) NOT NULL, 
  parent_folder_id varchar2(50), 
  model_id         varchar2(50) NOT NULL, 
  model_version    number(10) NOT NULL, 
  rank             number(10) NOT NULL, 
  PRIMARY KEY (fin_id));
CREATE TABLE images (
  path     varchar2(50) NOT NULL, 
  image    blob NOT NULL, 
  checksum varchar2(50) NOT NULL, 
  PRIMARY KEY (path));
CREATE TABLE models (
  id           varchar2(50) NOT NULL, 
  version      number(10) NOT NULL, 
  name         varchar2(1024) NOT NULL, 
  note         clob, 
  purpose      clob, 
  created_by   varchar2(30) NOT NULL, 
  created_on   date NOT NULL, 
  checkedin_by varchar2(30), 
  checkedin_on timestamp, 
  deleted_by   varchar2(30), 
  deleted_on   timestamp, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE properties (
  parent_id      varchar2(50) NOT NULL, 
  parent_version number(10) NOT NULL, 
  rank           number(10) NOT NULL, 
  name           varchar2(1024) NOT NULL, 
  value          clob NOT NULL, 
  PRIMARY KEY (parent_id, 
  parent_version, 
  rank));
CREATE TABLE relationships (
  id            varchar2(50) NOT NULL, 
  version       number(10) NOT NULL, 
  class         varchar2(50) NOT NULL, 
  name          varchar2(1024) NOT NULL, 
  documentation clob NOT NULL, 
  source_id     varchar2(50), 
  target_id     varchar2(50), 
  strength      varchar2(20), 
  access_type   number(10), 
  created_by    varchar2(30) NOT NULL, 
  created_on    timestamp NOT NULL, 
  checkedin_by  varchar2(30), 
  checkedin_on  timestamp, 
  deleted_by    varchar2(30), 
  deleted_on    timestamp, 
  checksum      varchar2(50) NOT NULL, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE relationships_in_model (
  cin_id               number(10) NOT NULL, 
  relationship_id      varchar2(50) NOT NULL, 
  relationship_version number(10) NOT NULL, 
  parent_folder_id     varchar2(50) NOT NULL, 
  model_id             varchar2(50) NOT NULL, 
  model_version        number(10) NOT NULL, 
  rank                 number(10) NOT NULL, 
  PRIMARY KEY (cin_id));
CREATE TABLE views (
  id                     varchar2(50) NOT NULL, 
  version                number(10) NOT NULL, 
  class                  varchar2(50) NOT NULL, 
  name                   varchar2(1024) NOT NULL, 
  documentation          clob NOT NULL, 
  hint_content           clob, 
  hint_title             varchar2(1024), 
  created_by             varchar2(30) NOT NULL, 
  created_on             timestamp NOT NULL, 
  background             number(10), 
  connection_router_type number(10) NOT NULL, 
  viewpoint              varchar2(30), 
  checksum               varchar2(50) NOT NULL, 
  PRIMARY KEY (id, 
  version));
CREATE TABLE views_connections (
  id               varchar2(50) NOT NULL, 
  version          number(10) NOT NULL, 
  container_id     varchar2(50) NOT NULL, 
  view_id          varchar2(50) NOT NULL, 
  view_version     number(10) NOT NULL, 
  class            varchar2(50) NOT NULL, 
  name             varchar2(1024), 
  documentation    clob, 
  is_locked        number(1), 
  line_color       varchar2(7), 
  line_width       number(10), 
  font             varchar2(150), 
  font_color       varchar2(7), 
  relationship_id  varchar2(50), 
  source_object_id varchar2(50), 
  target_object_id varchar2(50), 
  type             number(10), 
  rank             number(10) NOT NULL, 
  checksum         varchar2(50) NOT NULL, 
  PRIMARY KEY (id, 
  version, 
  container_id));
COMMENT ON TABLE views_connections IS 'views_connections parents can be either a view, a canvas or a sketch but any container as well.';
CREATE TABLE views_in_model (
  vin_id           number(10) NOT NULL, 
  view_id          varchar2(50) NOT NULL, 
  view_version     number(10) NOT NULL, 
  parent_folder_id varchar2(50) NOT NULL, 
  model_id         varchar2(50) NOT NULL, 
  model_version    number(10) NOT NULL, 
  rank             number(10), 
  PRIMARY KEY (vin_id));
CREATE TABLE views_objects (
  id             varchar2(50) NOT NULL, 
  version        number(10) NOT NULL, 
  container_id   varchar2(50) NOT NULL, 
  view_id        varchar2(50) NOT NULL, 
  view_version   number(10) NOT NULL, 
  class          varchar2(50) NOT NULL, 
  element_id     varchar2(50), 
  diagram_ref_id varchar2(50), 
  border_color   varchar2(7), 
  border_type    number(10), 
  content        clob, 
  documentation  clob, 
  hint_content   clob, 
  hint_title     varchar2(1024), 
  is_locked      number(1), 
  image_path     varchar2(50), 
  image_position number(10), 
  line_color     varchar2(7), 
  line_width     number(10), 
  fill_color     varchar2(7), 
  font           varchar2(150), 
  font_color     varchar2(7), 
  name           varchar2(1024), 
  notes          clob, 
  text_alignment number(10), 
  text_position  number(10), 
  type           number(10), 
  x              number(10), 
  y              number(10), 
  width          number(10), 
  height         number(10), 
  rank           number(10) NOT NULL, 
  checksum       varchar2(50) NOT NULL, 
  PRIMARY KEY (id, 
  version, 
  container_id));
COMMENT ON TABLE views_objects IS 'views_objects parents can be either a view, a canvas or a sketch but any container as well.';
COMMENT ON COLUMN views_objects.rank IS 'the import order is important to respect the superposition';

INSERT INTO database_version (archi_plugin, version) VALUES('DatabasePlugin', 200);
